# 操作符

## 自增(++)/自减(--)

该操作符可以作用于任何值，意思是不限于整数——字符串、布尔值、浮点值，甚至对象都可以。

规则：

1. 字符串：转为数字再操作，转换失败则为`NaN`
2. 布尔值：`true -> 1`，`false -> 0`后再操作。
3. 对象：如果有`valueOf`或`toString`，则调用后应用以上规则。（只调用一个，优先`valueOf`）

## 一元加或减

非数值转换规则：
1. 字符串: 调用`Number`转数值.
2. `布尔和对象`的转换规则和 `自增` 相同。

## 位操作符

### 负数

负值以一种称为补码的二进制编码存储。一个数值的二补数通过如下3个步骤计算得到：

1. 确定绝对值的二进制表示（如，对于-18，先确定18的二进制表示）；
2. 找到数值的反码，换句话说，就是每个0都变成1，每个1都变成0；
3. 给结果加1。

例：计算`-18`的过程:

18的二进制：
```
0000   0000   0000   0000   0000   0000   0001   0010
```

反码:
```
1111   1111   1111   1111   1111   1111   1110   1101
```

反码加1:
```
1111   1111   1111   1111   1111   1111   1110   1101
1111   1111   1111   1111   1111   1111   1110   1110 // -18的二进制
```

ECMAScript会帮我们记录这些信息。在把负值输出为一个二进制字符串时，我们会得到一个前面加了减号的绝对值，如下所示：

```js title=
let num = -18;
console.log(num.toString(2)); // "-10010"
```

如果将位操作符应用到`非数值`，那么首先会使用Number()函数将该值转换为数值（这个过程是自动的），然后再应用位操作。最终结果是数值。

### 按位非 ~

```js title=
let num1 = 25;       // 二进制00000000000000000000000000011001
let num2 = ~num1;    // 二进制11111111111111111111111111100110
console.log(num2);   // -26
```

相当于`-25 - 1`的结果。

### 按位与 &

- `1 & 1 -> 1`
- `0 & 0 -> 0`
- `1 & 0 -> 0`

```js title=
25  = 00000000000000000000000000011001
 3  = 00000000000000000000000000000011

AND = 00000000000000000000000000000001
```

### 按位或 |

- `1 | 1 -> 1`
- `0 | 0 -> 0`
- `1 | 0 -> 1`

```js title=
25 = 00000000000000000000000000011001
 3 = 00000000000000000000000000000011

OR = 00000000000000000000000000011011
```

### 按位异或 ^

- `1 ^ 1 -> 0`
- `0 ^ 0 -> 0`
- `1 ^ 0 -> 1`

```js title=
 25  = 00000000000000000000000000011001
 3  = 00000000000000000000000000000011

XOR = 00000000000000000000000000011010
```

### 左移 \<\<

```js title=
let oldValue = 2;                  // 等于二进制10
let newValue = oldValue << 5;   // 等于二进制1000000，即十进制64
```

注意，左移会保留它所操作数值的符号。比如，如果-2左移5位，将得到-64，而不是正64。

### 有符号右移 >>

有符号右移由两个大于号（>>）表示，会将数值的所有32位都向右移，同时保留符号（正或负）。有符号右移实际上是左移的逆运算。

```js title=
let oldValue = 64;                // 等于二进制1000000
let newValue = oldValue >> 5;   // 等于二进制10，即十进制2
```

同样，移位后就会出现空位。不过，右移后空位会出现在左侧，且在符号位之后。ECMAScript会用符号位的值来填充这些空位，以得到完整的数值。

![20240109174525](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20240109174525.png)

### 无符号右移 >>>

无符号右移用3个大于号表示（>>>），会将数值的所有32位都向右移。对于正数，无符号右移与有符号右移结果相同。仍然以前面有符号右移的例子为例，64向右移动5位，会变成2：

```js title=
let oldValue = 64;                  // 等于二进制1000000
let newValue = oldValue >>> 5;   // 等于二进制10，即十进制2
```

## 乘法操作符 *

- 如果有任一操作数是NaN，则返回NaN。
- 如果是Infinity乘以0，则返回NaN。
- 如果是Infinity乘以非0的有限数值，则根据第二个操作数的符号返回Infinity或-Infinity。
- 如果是Infinity乘以Infinity，则返回Infinity。
- 如果有不是数值的操作数，则先在后台用Number()将其转换为数值，然后再应用上述规则。

## 除法操作符 /

- 如果操作数都是数值，则执行常规的除法运算，即两个正值相除是正值，两个负值相除也是正值，符号不同的值相除得到负值。
如果ECMAScript不能表示商，则返回Infinity或-Infinity。
- 如果有任一操作数是NaN，则返回NaN。
- 如果是Infinity除以Infinity，则返回NaN。
- 如果是0除以0，则返回NaN。
- 如果是非0的有限值除以0，则根据第一个操作数的符号返回Infinity或-Infinity。
- 如果是Infinity除以任何数值，则根据第二个操作数的符号返回Infinity或-Infinity。
- 如果有不是数值的操作数，则先在后台用Number()函数将其转换为数值，然后再应用上述规则。

## 取模操作符 %

取模（余数）操作符由一个百分比符号（%）表示，比如：

```js title=
letresult=26%5;//等于1
```

- 如果操作数是数值，则执行常规除法运算，返回余数。
- 如果被除数是无限值，除数是有限值，则返回NaN。
- 如果被除数是有限值，除数是0，则返回NaN。
- 如果是Infinity除以Infinity，则返回NaN。
- 如果被除数是有限值，除数是无限值，则返回被除数。
- 如果被除数是0，除数不是0，则返回0。
- 如果有不是数值的操作数，则先在后台用Number()函数将其转换为数值，然后再应用上述规则。

## 指数操作符 **

`Math.pow` 和 `**`相同。

```js title=
console.log(Math.pow(3, 2);     // 9
console.log(3 ** 2);              // 9
console.log(Math.pow(16, 0.5); // 4
console.log(16 ** 0.5);           // 4
```

也可用`**=`，如

```js title=
let squared = 3;
squared **= 2;
console.log(squared); // 9
```

## 加法操作符 +

- 如果有任一操作数是NaN，则返回NaN；
- 如果是Infinity加Infinity，则返回Infinity；
- 如果是-Infinity加-Infinity，则返回-Infinity；
- 如果是Infinity加-Infinity，则返回NaN；
- 如果是+0加+0，则返回+0；
- 如果是-0加+0，则返回+0；
- 如果是-0加-0，则返回-0。

不过，如果有一个操作数是字符串，则要应用如下规则：

- 如果两个操作数都是字符串，则将第二个字符串拼接到第一个字符串后面；
- 如果只有一个操作数是字符串，则将另一个操作数转换为字符串，再将两个字符串拼接在一起。
- 如果有任一操作数是对象、数值或布尔值，则调用它们的toString()方法以获取字符串，然后再应用前面的关于字符串的规则。
- 对于undefined和null，则调用String()函数，分别获取"undefined"和"null"。

## 关系操作符

关系操作符执行比较两个值的操作，包括小于（\<）、大于（>）、小于等于（\<=）和大于等于（>=）

规则：

- 如果操作数都是数值，则执行数值比较。
- 如果操作数都是字符串，则逐个比较字符串中对应字符的编码。
- 如果有任一操作数是数值，则将另一个操作数转换为数值，执行数值比较。
- 如果有任一操作数是对象，则调用其valueOf()方法，取得结果后再根据前面的规则执行比较。如果没有valueOf()操作符，则调用toString()方法，取得结果后再根据前面的规则执行比较。
- 如果有任一操作数是布尔值，则将其转换为数值再执行比较。
- 任何关系操作符在涉及比较NaN时都返回false

```js title=
let result = "23" < 3; // false
```

所有和`NaN`比较的,都返回false

```js title=
let result = "a" < 3; // 因为"a"会转换为NaN，所以结果是false

let result1 = NaN < 3;   // false
let result2 = NaN >= 3; // false
```

## 相等、不相等操作符 == 、 !=

规则：

1. 如果任一操作数是布尔值，则将其转换为数值再比较是否相等。false转换为0, true转换为1。
2. 如果一个操作数是字符串，另一个操作数是数值，则尝试将字符串转换为数值，再比较是否相等。
3. 如果一个操作数是对象，另一个操作数不是，则调用对象的valueOf()方法取得其原始值，再根据前面的规则进行比较。

```js title=规则1、规则3 举例
const obj = {
  valueOf() {
    return 1
  },
}
console.log(obj == true); // true

const obj2 = {
  valueOf() {
    return 2
  },
}
console.log(obj2 == true); // false，因为obj2被转换为2,而true被转换为1

const obj3 = {
  valueOf() {
    return 0
  },
}
console.log(obj3 == false); // true
```

4. null和undefined相等。
5. null和undefined不能转换为其他类型的值再进行比较。
6. 两个都是对象，比较内存地址。

![20240109183354](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20240109183354.png)
